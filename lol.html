local AuroraUI = {}
AuroraUI.__index = AuroraUI

-- Northern Lights Color Palette
local AuroraColors = {
    Primary = Color3.fromRGB(38, 92, 120),      -- Deep blue
    Accent1 = Color3.fromRGB(80, 255, 255),     -- Cyan
    Accent2 = Color3.fromRGB(120, 255, 196),    -- Mint
    Accent3 = Color3.fromRGB(255, 120, 255),    -- Pink
    Accent4 = Color3.fromRGB(120, 180, 255),    -- Light blue
    Accent5 = Color3.fromRGB(255, 255, 120),    -- Yellow
    Background = Color3.fromRGB(24, 28, 38),    -- Night sky
    Section = Color3.fromRGB(32, 40, 56),
    Button = Color3.fromRGB(38, 120, 120),
    ButtonHover = Color3.fromRGB(80, 180, 180),
    ToggleOn = Color3.fromRGB(120, 255, 196),
    ToggleOff = Color3.fromRGB(60, 80, 100),
    Slider = Color3.fromRGB(80, 255, 255),
    Dropdown = Color3.fromRGB(38, 92, 120),
    Text = Color3.fromRGB(230, 240, 255),
    Placeholder = Color3.fromRGB(120, 180, 255),
    Shadow = Color3.fromRGB(0, 0, 0),
}

-- Utility: Tween helper
local function tween(obj, props, duration, style, direction)
    local TweenService = game:GetService("TweenService")
    local info = TweenInfo.new(duration or 0.2, style or Enum.EasingStyle.Quad, direction or Enum.EasingDirection.Out)
    TweenService:Create(obj, info, props):Play()
end

-- Utility: Create shadow
local function addShadow(parent, size, transparency)
    local shadow = Instance.new("ImageLabel")
    shadow.Name = "AuroraShadow"
    shadow.Parent = parent
    shadow.BackgroundTransparency = 1
    shadow.Image = "rbxassetid://1316045217" -- Soft shadow asset
    shadow.Size = UDim2.new(1, size or 24, 1, size or 24)
    shadow.Position = UDim2.new(0, -(size or 12), 0, -(size or 12))
    shadow.ImageTransparency = transparency or 0.5
    shadow.ZIndex = parent.ZIndex - 1
    return shadow
end

-- Utility: Rounded corners
local function roundify(obj, radius)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, radius or 12)
    corner.Parent = obj
end

-- Utility: UIListLayout helper
local function verticalList(parent, padding)
    local layout = Instance.new("UIListLayout")
    layout.Parent = parent
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    layout.Padding = UDim.new(0, padding or 8)
    return layout
end

-- Window Class
local Window = {}
Window.__index = Window

function AuroraUI:CreateWindow(opts)
    opts = opts or {}
    local self = setmetatable({}, Window)
    self.Title = opts.Title or "AuroraUI"
    self.Width = opts.Width or 500
    self.Height = opts.Height or 350
    self.Sections = {}

    -- ScreenGui
    self.Gui = Instance.new("ScreenGui")
    self.Gui.Name = "AuroraUI"
    self.Gui.Parent = game:GetService("CoreGui")
    self.Gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

    -- Main Frame
    self.Main = Instance.new("Frame")
    self.Main.Name = "Main"
    self.Main.Parent = self.Gui
    self.Main.Size = UDim2.new(0, self.Width, 0, self.Height)
    self.Main.Position = UDim2.new(0.5, -self.Width/2, 0.5, -self.Height/2)
    self.Main.BackgroundColor3 = AuroraColors.Background
    self.Main.BorderSizePixel = 0
    self.Main.ZIndex = 10
    roundify(self.Main, 18)
    addShadow(self.Main, 32, 0.6)

    -- Title Bar
    self.TitleBar = Instance.new("Frame")
    self.TitleBar.Name = "TitleBar"
    self.TitleBar.Parent = self.Main
    self.TitleBar.Size = UDim2.new(1, 0, 0, 44)
    self.TitleBar.BackgroundColor3 = AuroraColors.Primary
    self.TitleBar.BorderSizePixel = 0
    self.TitleBar.ZIndex = 11
    roundify(self.TitleBar, 18)

    -- Title Text
    self.TitleLabel = Instance.new("TextLabel")
    self.TitleLabel.Parent = self.TitleBar
    self.TitleLabel.Size = UDim2.new(1, -48, 1, 0)
    self.TitleLabel.Position = UDim2.new(0, 16, 0, 0)
    self.TitleLabel.BackgroundTransparency = 1
    self.TitleLabel.Text = self.Title
    self.TitleLabel.Font = Enum.Font.GothamBold
    self.TitleLabel.TextSize = 20
    self.TitleLabel.TextColor3 = AuroraColors.Text
    self.TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    self.TitleLabel.ZIndex = 12

    -- Close Button
    self.Close = Instance.new("TextButton")
    self.Close.Parent = self.TitleBar
    self.Close.Size = UDim2.new(0, 32, 0, 32)
    self.Close.Position = UDim2.new(1, -40, 0.5, -16)
    self.Close.BackgroundColor3 = AuroraColors.Accent3
    self.Close.Text = "âœ•"
    self.Close.TextColor3 = AuroraColors.Text
    self.Close.TextSize = 18
    self.Close.Font = Enum.Font.GothamBold
    self.Close.ZIndex = 13
    roundify(self.Close, 16)
    self.Close.MouseButton1Click:Connect(function()
        self:Hide()
    end)
    self.Close.MouseEnter:Connect(function()
        tween(self.Close, {BackgroundColor3 = AuroraColors.Accent1}, 0.15)
    end)
    self.Close.MouseLeave:Connect(function()
        tween(self.Close, {BackgroundColor3 = AuroraColors.Accent3}, 0.15)
    end)

    -- Content Holder
    self.Content = Instance.new("Frame")
    self.Content.Parent = self.Main
    self.Content.Size = UDim2.new(1, -32, 1, -60)
    self.Content.Position = UDim2.new(0, 16, 0, 52)
    self.Content.BackgroundTransparency = 1
    self.Content.ZIndex = 11
    verticalList(self.Content, 12)

    -- Dragging
    local dragging, dragInput, dragStart, startPos
    self.TitleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = self.Main.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    self.TitleBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end
    end)
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            self.Main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)

    return self
end

function Window:AddSection(title)
    local Section = {}
    Section.Title = title or "Section"
    Section.Items = {}
    Section.Parent = self.Content

    -- Section Frame
    Section.Frame = Instance.new("Frame")
    Section.Frame.Parent = self.Content
    Section.Frame.Size = UDim2.new(1, 0, 0, 48)
    Section.Frame.BackgroundColor3 = AuroraColors.Section
    Section.Frame.BorderSizePixel = 0
    Section.Frame.ZIndex = 12
    roundify(Section.Frame, 14)
    verticalList(Section.Frame, 8)

    -- Section Title
    Section.Label = Instance.new("TextLabel")
    Section.Label.Parent = Section.Frame
    Section.Label.Size = UDim2.new(1, -16, 0, 28)
    Section.Label.Position = UDim2.new(0, 8, 0, 0)
    Section.Label.BackgroundTransparency = 1
    Section.Label.Text = Section.Title
    Section.Label.Font = Enum.Font.GothamBold
    Section.Label.TextSize = 16
    Section.Label.TextColor3 = AuroraColors.Accent1
    Section.Label.TextXAlignment = Enum.TextXAlignment.Left
    Section.Label.ZIndex = 13

    -- Items Holder
    Section.ItemsHolder = Instance.new("Frame")
    Section.ItemsHolder.Parent = Section.Frame
    Section.ItemsHolder.Size = UDim2.new(1, -16, 0, 0)
    Section.ItemsHolder.Position = UDim2.new(0, 8, 0, 32)
    Section.ItemsHolder.BackgroundTransparency = 1
    Section.ItemsHolder.ZIndex = 13
    verticalList(Section.ItemsHolder, 6)

    -- Section expand/collapse
    local expanded = true
    Section.Label.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            expanded = not expanded
            if expanded then
                tween(Section.ItemsHolder, {Size = UDim2.new(1, -16, 0, #Section.Items * 38)}, 0.18)
            else
                tween(Section.ItemsHolder, {Size = UDim2.new(1, -16, 0, 0)}, 0.18)
            end
        end
    end)

    -- Add item methods
    function Section:AddButton(text, callback)
        local btn = Instance.new("TextButton")
        btn.Parent = Section.ItemsHolder
        btn.Size = UDim2.new(1, 0, 0, 32)
        btn.BackgroundColor3 = AuroraColors.Button
        btn.Text = text
        btn.TextColor3 = AuroraColors.Text
        btn.TextSize = 15
        btn.Font = Enum.Font.Gotham
        btn.AutoButtonColor = false
        btn.ZIndex = 14
        roundify(btn, 10)
        btn.MouseButton1Click:Connect(function()
            tween(btn, {BackgroundColor3 = AuroraColors.ButtonHover}, 0.12)
            callback()
            tween(btn, {BackgroundColor3 = AuroraColors.Button}, 0.18)
        end)
        btn.MouseEnter:Connect(function()
            tween(btn, {BackgroundColor3 = AuroraColors.ButtonHover}, 0.15)
        end)
        btn.MouseLeave:Connect(function()
            tween(btn, {BackgroundColor3 = AuroraColors.Button}, 0.15)
        end)
        table.insert(Section.Items, btn)
        Section.ItemsHolder.Size = UDim2.new(1, -16, 0, #Section.Items * 38)
        return btn
    end

    function Section:AddToggle(text, default, callback)
        local toggle = Instance.new("TextButton")
        toggle.Parent = Section.ItemsHolder
        toggle.Size = UDim2.new(1, 0, 0, 32)
        toggle.BackgroundColor3 = AuroraColors.ToggleOff
        toggle.Text = ""
        toggle.AutoButtonColor = false
        toggle.ZIndex = 14
        roundify(toggle, 10)

        local label = Instance.new("TextLabel")
        label.Parent = toggle
        label.Size = UDim2.new(1, -40, 1, 0)
        label.Position = UDim2.new(0, 12, 0, 0)
        label.BackgroundTransparency = 1
        label.Text = text
        label.TextColor3 = AuroraColors.Text
        label.TextSize = 15
        label.Font = Enum.Font.Gotham
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.ZIndex = 15

        local state = default or false
        local indicator = Instance.new("Frame")
        indicator.Parent = toggle
        indicator.Size = UDim2.new(0, 24, 0, 24)
        indicator.Position = UDim2.new(1, -32, 0.5, -12)
        indicator.BackgroundColor3 = state and AuroraColors.ToggleOn or AuroraColors.ToggleOff
        indicator.ZIndex = 15
        roundify(indicator, 12)

        toggle.MouseButton1Click:Connect(function()
            state = not state
            tween(indicator, {BackgroundColor3 = state and AuroraColors.ToggleOn or AuroraColors.ToggleOff}, 0.18)
            callback(state)
        end)
        table.insert(Section.Items, toggle)
        Section.ItemsHolder.Size = UDim2.new(1, -16, 0, #Section.Items * 38)
        return toggle
    end

    function Section:AddSlider(text, min, max, default, callback)
        local sliderFrame = Instance.new("Frame")
        sliderFrame.Parent = Section.ItemsHolder
        sliderFrame.Size = UDim2.new(1, 0, 0, 32)
        sliderFrame.BackgroundTransparency = 1
        sliderFrame.ZIndex = 14

        local label = Instance.new("TextLabel")
        label.Parent = sliderFrame
        label.Size = UDim2.new(0.4, 0, 1, 0)
        label.Position = UDim2.new(0, 0, 0, 0)
        label.BackgroundTransparency = 1
        label.Text = text
        label.TextColor3 = AuroraColors.Text
        label.TextSize = 15
        label.Font = Enum.Font.Gotham
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.ZIndex = 15

        local sliderBar = Instance.new("Frame")
        sliderBar.Parent = sliderFrame
        sliderBar.Size = UDim2.new(0.5, 0, 0, 8)
        sliderBar.Position = UDim2.new(0.45, 0, 0.5, -4)
        sliderBar.BackgroundColor3 = AuroraColors.Slider
        sliderBar.ZIndex = 15
        roundify(sliderBar, 4)

        local sliderBtn = Instance.new("Frame")
        sliderBtn.Parent = sliderBar
        sliderBtn.Size = UDim2.new(0, 16, 0, 16)
        sliderBtn.Position = UDim2.new(0, 0, 0.5, -8)
        sliderBtn.BackgroundColor3 = AuroraColors.Accent2
        sliderBtn.ZIndex = 16
        roundify(sliderBtn, 8)

        local valueLabel = Instance.new("TextLabel")
        valueLabel.Parent = sliderFrame
        valueLabel.Size = UDim2.new(0.1, 0, 1, 0)
        valueLabel.Position = UDim2.new(0.95, -32, 0, 0)
        valueLabel.BackgroundTransparency = 1
        valueLabel.Text = tostring(default or min)
        valueLabel.TextColor3 = AuroraColors.Accent1
        valueLabel.TextSize = 15
        valueLabel.Font = Enum.Font.Gotham
        valueLabel.TextXAlignment = Enum.TextXAlignment.Right
        valueLabel.ZIndex = 15

        local dragging = false
        local value = default or min
        local function setValue(newValue)
            value = math.clamp(newValue, min, max)
            local percent = (value - min) / (max - min)
            sliderBtn.Position = UDim2.new(percent, -8, 0.5, -8)
            valueLabel.Text = tostring(value)
            callback(value)
        end
        setValue(value)
        sliderBar.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true
            end
        end)
        sliderBar.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = false
            end
        end)
        game:GetService("UserInputService").InputChanged:Connect(function(input)
            if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                local absPos = sliderBar.AbsolutePosition.X
                local absSize = sliderBar.AbsoluteSize.X
                local mouseX = input.Position.X
                local percent = math.clamp((mouseX - absPos) / absSize, 0, 1)
                setValue(math.floor(min + (max - min) * percent + 0.5))
            end
        end)
        table.insert(Section.Items, sliderFrame)
        Section.ItemsHolder.Size = UDim2.new(1, -16, 0, #Section.Items * 38)
        return sliderFrame
    end

    function Section:AddDropdown(text, options, callback)
        local dropdown = Instance.new("TextButton")
        dropdown.Parent = Section.ItemsHolder
        dropdown.Size = UDim2.new(1, 0, 0, 32)
        dropdown.BackgroundColor3 = AuroraColors.Dropdown
        dropdown.Text = ""
        dropdown.AutoButtonColor = false
        dropdown.ZIndex = 14
        roundify(dropdown, 10)

        local label = Instance.new("TextLabel")
        label.Parent = dropdown
        label.Size = UDim2.new(0.6, 0, 1, 0)
        label.Position = UDim2.new(0, 12, 0, 0)
        label.BackgroundTransparency = 1
        label.Text = text
        label.TextColor3 = AuroraColors.Text
        label.TextSize = 15
        label.Font = Enum.Font.Gotham
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.ZIndex = 15

        local selected = Instance.new("TextLabel")
        selected.Parent = dropdown
        selected.Size = UDim2.new(0.3, 0, 1, 0)
        selected.Position = UDim2.new(0.65, 0, 0, 0)
        selected.BackgroundTransparency = 1
        selected.Text = options[1] or ""
        selected.TextColor3 = AuroraColors.Accent2
        selected.TextSize = 15
        selected.Font = Enum.Font.Gotham
        selected.TextXAlignment = Enum.TextXAlignment.Right
        selected.ZIndex = 15

        local open = false
        local optionFrames = {}
        dropdown.MouseButton1Click:Connect(function()
            open = not open
            for _, f in ipairs(optionFrames) do
                f.Visible = open
            end
        end)
        for i, opt in ipairs(options) do
            local optBtn = Instance.new("TextButton")
            optBtn.Parent = Section.ItemsHolder
            optBtn.Size = UDim2.new(1, -24, 0, 28)
            optBtn.Position = UDim2.new(0, 12, 0, 0)
            optBtn.BackgroundColor3 = AuroraColors.Section
            optBtn.Text = opt
            optBtn.TextColor3 = AuroraColors.Text
            optBtn.TextSize = 14
            optBtn.Font = Enum.Font.Gotham
            optBtn.Visible = false
            optBtn.ZIndex = 15
            roundify(optBtn, 8)
            optBtn.MouseButton1Click:Connect(function()
                selected.Text = opt
                callback(opt)
                open = false
                for _, f in ipairs(optionFrames) do
                    f.Visible = false
                end
            end)
            table.insert(optionFrames, optBtn)
        end
        table.insert(Section.Items, dropdown)
        for _, f in ipairs(optionFrames) do
            table.insert(Section.Items, f)
        end
        Section.ItemsHolder.Size = UDim2.new(1, -16, 0, #Section.Items * 38)
        return dropdown
    end

    function Section:AddTextBox(text, callback)
        local box = Instance.new("TextBox")
        box.Parent = Section.ItemsHolder
        box.Size = UDim2.new(1, 0, 0, 32)
        box.BackgroundColor3 = AuroraColors.Section
        box.Text = ""
        box.PlaceholderText = text
        box.PlaceholderColor3 = AuroraColors.Placeholder
        box.TextColor3 = AuroraColors.Text
        box.TextSize = 15
        box.Font = Enum.Font.Gotham
        box.ZIndex = 14
        roundify(box, 10)
        box.FocusLost:Connect(function(enter)
            if enter then
                callback(box.Text)
                box.Text = ""
            end
        end)
        table.insert(Section.Items, box)
        Section.ItemsHolder.Size = UDim2.new(1, -16, 0, #Section.Items * 38)
        return box
    end

    function Section:AddKeybind(text, defaultKey, callback)
        local keyBtn = Instance.new("TextButton")
        keyBtn.Parent = Section.ItemsHolder
        keyBtn.Size = UDim2.new(1, 0, 0, 32)
        keyBtn.BackgroundColor3 = AuroraColors.Section
        keyBtn.Text = ""
        keyBtn.AutoButtonColor = false
        keyBtn.ZIndex = 14
        roundify(keyBtn, 10)

        local label = Instance.new("TextLabel")
        label.Parent = keyBtn
        label.Size = UDim2.new(0.6, 0, 1, 0)
        label.Position = UDim2.new(0, 12, 0, 0)
        label.BackgroundTransparency = 1
        label.Text = text
        label.TextColor3 = AuroraColors.Text
        label.TextSize = 15
        label.Font = Enum.Font.Gotham
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.ZIndex = 15

        local keyLabel = Instance.new("TextLabel")
        keyLabel.Parent = keyBtn
        keyLabel.Size = UDim2.new(0.3, 0, 1, 0)
        keyLabel.Position = UDim2.new(0.65, 0, 0, 0)
        keyLabel.BackgroundTransparency = 1
        keyLabel.Text = defaultKey.Name
        keyLabel.TextColor3 = AuroraColors.Accent4
        keyLabel.TextSize = 15
        keyLabel.Font = Enum.Font.Gotham
        keyLabel.TextXAlignment = Enum.TextXAlignment.Right
        keyLabel.ZIndex = 15

        local listening = false
        keyBtn.MouseButton1Click:Connect(function()
            keyLabel.Text = "..."
            listening = true
        end)
        game:GetService("UserInputService").InputBegan:Connect(function(input, processed)
            if listening and not processed and input.KeyCode ~= Enum.KeyCode.Unknown then
                keyLabel.Text = input.KeyCode.Name
                listening = false
                callback()
            elseif not listening and input.KeyCode.Name == keyLabel.Text then
                callback()
            end
        end)
        table.insert(Section.Items, keyBtn)
        Section.ItemsHolder.Size = UDim2.new(1, -16, 0, #Section.Items * 38)
        return keyBtn
    end

    table.insert(self.Sections, Section)
    return Section
end

function Window:Show()
    self.Gui.Enabled = true
    tween(self.Main, {Position = UDim2.new(0.5, -self.Width/2, 0.5, -self.Height/2)}, 0.25)
    tween(self.Main, {BackgroundTransparency = 0}, 0.25)
end

function Window:Hide()
    tween(self.Main, {BackgroundTransparency = 1}, 0.18)
    wait(0.18)
    self.Gui.Enabled = false
end

return setmetatable(AuroraUI, {
    __call = function(cls, ...)
        return cls:CreateWindow(...)
    end
})
